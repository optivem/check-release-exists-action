name: Test Action

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:
    inputs:
      test_version:
        description: 'Version to test with'
        required: false
        default: 'v1.0.0'

jobs:
  test-action:
    runs-on: ubuntu-latest
    name: Test Check Release Exists Action
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Test with existing release (should pass if v1.0.0 exists)
        id: test-existing
        uses: ./
        continue-on-error: true
        with:
          version: ${{ github.event.inputs.test_version || 'v1.0.0' }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Test with non-existing release (should fail)
        id: test-nonexisting
        uses: ./
        continue-on-error: true
        with:
          version: 'v999.999.999-nonexistent'
          github-token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Display test results
        run: |
          echo "Test with existing release:"
          echo "  Exists: ${{ steps.test-existing.outputs.exists }}"
          echo "  Tag: ${{ steps.test-existing.outputs.tag }}"
          echo ""
          echo "Test with non-existing release:"
          echo "  Exists: ${{ steps.test-nonexisting.outputs.exists }}"
          echo "  Tag: ${{ steps.test-nonexisting.outputs.tag }}"
      
      - name: Validate results
        run: |
          # The non-existing release test should always return false
          if [ "${{ steps.test-nonexisting.outputs.exists }}" != "false" ]; then
            echo "❌ Non-existing release test failed - should return false"
            exit 1
          fi
          echo "✅ Action tests completed successfully"

  test-cross-platform:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
    
    runs-on: ${{ matrix.os }}
    name: Test on ${{ matrix.os }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Test action on ${{ matrix.os }}
        uses: ./
        continue-on-error: true
        with:
          version: 'v999.999.999-test'
          github-token: ${{ secrets.GITHUB_TOKEN }}